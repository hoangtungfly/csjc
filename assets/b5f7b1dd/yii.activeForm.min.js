(function(g){g.fn.yiiActiveForm=function(o){if(c[o]){return c[o].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof o==="object"||!o){return c.init.apply(this,arguments)}else{g.error("Method "+o+" does not exist on jQuery.yiiActiveForm");return false}}};var n={beforeValidate:"beforeValidate",afterValidate:"afterValidate",beforeValidateAttribute:"beforeValidateAttribute",afterValidateAttribute:"afterValidateAttribute",beforeSubmit:"beforeSubmit",ajaxBeforeSend:"ajaxBeforeSend",ajaxComplete:"ajaxComplete"};var e={encodeErrorSummary:true,errorSummary:".error-summary",validateOnSubmit:true,errorCssClass:"has-error",successCssClass:"has-success",validatingCssClass:"validating",ajaxParam:"ajax",ajaxDataType:"json",validationUrl:undefined};var d={id:undefined,name:undefined,container:undefined,input:undefined,error:".help-block",encodeError:true,validateOnChange:true,validateOnBlur:true,validateOnType:false,validationDelay:500,enableAjaxValidation:false,validate:undefined,status:0,cancelled:false,value:undefined};var c={init:function(o,p){return this.each(function(){var q=g(this);if(q.data("yiiActiveForm")){return}var r=g.extend({},e,p||{});if(r.validationUrl===undefined){r.validationUrl=q.prop("action")}g.each(o,function(s){o[s]=g.extend({value:f(q,this)},d,this);h(q,o[s])});q.data("yiiActiveForm",{settings:r,attributes:o,submitting:false,validated:false});q.bind("reset.yiiActiveForm",c.resetForm);if(r.validateOnSubmit){q.on("mouseup.yiiActiveForm keyup.yiiActiveForm",":submit",function(){q.data("yiiActiveForm").submitObject=g(this)});q.on("submit.yiiActiveForm",c.submitForm)}})},add:function(p){var o=g(this);p=g.extend({value:f(o,p)},d,p);o.data("yiiActiveForm").attributes.push(p);h(o,p)},remove:function(s){var p=g(this),o=p.data("yiiActiveForm").attributes,q=-1,r=undefined;g.each(o,function(t){if(o[t]["id"]==s){q=t;r=o[t];return false}});if(q>=0){o.splice(q,1);j(p,r)}return r},validateAttribute:function(p){var o=c.find.call(this,p);if(o!=undefined){k(g(this),o,true)}},find:function(q){var p=g(this).data("yiiActiveForm").attributes,o=undefined;g.each(p,function(r){if(p[r]["id"]==q){o=p[r];return false}});return o},destroy:function(){return this.each(function(){g(this).unbind(".yiiActiveForm");g(this).removeData("yiiActiveForm")})},data:function(){return this.data("yiiActiveForm")},validate:function(){var p=g(this),u=p.data("yiiActiveForm"),o=false,s={},r=a(),t=u.submitting;if(t){var q=g.Event(n.beforeValidate);p.trigger(q,[s,r]);if(q.result===false){u.submitting=false;return}}g.each(u.attributes,function(){this.cancelled=false;if(u.submitting||this.status===2||this.status===3){var w=s[this.id];if(w===undefined){w=[];s[this.id]=w}var v=g.Event(n.beforeValidateAttribute);p.trigger(v,[this,w,r]);if(v.result!==false){if(this.validate){this.validate(this,f(p,this),w,r,p)}if(this.enableAjaxValidation){o=true}}else{this.cancelled=true}}});g.when.apply(this,r).always(function(){for(var v in s){if(0===s[v].length){delete s[v]}}if(o){var w=u.submitObject,x="&"+u.settings.ajaxParam+"="+p.prop("id");if(w&&w.length&&w.prop("name")){x+="&"+w.prop("name")+"="+w.prop("value")}g.ajax({url:u.settings.validationUrl,type:p.prop("method"),data:p.serialize()+x,dataType:u.settings.ajaxDataType,complete:function(y,z){p.trigger(n.ajaxComplete,[y,z])},beforeSend:function(z,y){p.trigger(n.ajaxBeforeSend,[z,y])},success:function(y){if(y!==null&&typeof y==="object"){g.each(u.attributes,function(){if(!this.enableAjaxValidation||this.cancelled){delete y[this.id]}});m(p,g.extend(s,y),t)}else{m(p,s,t)}},error:function(){u.submitting=false}})}else{if(u.submitting){setTimeout(function(){m(p,s,t)},200)}else{m(p,s,t)}}})},submitForm:function(){var o=g(this),q=o.data("yiiActiveForm");if(q.validated){q.submitting=false;var p=g.Event(n.beforeSubmit);o.trigger(p);if(p.result===false){q.validated=false;return false}return true}else{if(q.settings.timer!==undefined){clearTimeout(q.settings.timer)}q.submitting=true;c.validate.call(o);return false}},resetForm:function(){var o=g(this);var p=o.data("yiiActiveForm");setTimeout(function(){g.each(p.attributes,function(){this.value=f(o,this);this.status=0;var q=o.find(this.container);q.removeClass(p.settings.validatingCssClass+" "+p.settings.errorCssClass+" "+p.settings.successCssClass);q.find(this.error).html("")});o.find(p.settings.errorSummary).hide().find("ul").html("")},1)}};var h=function(o,p){var q=b(o,p);if(p.validateOnChange){q.on("change.yiiActiveForm",function(){k(o,p,false)})}if(p.validateOnBlur){q.on("blur.yiiActiveForm",function(){if(p.status==0||p.status==1){k(o,p,!p.status)}})}if(p.validateOnType){q.on("keyup.yiiActiveForm",function(){if(p.value!==f(o,p)){k(o,p,false,p.validationDelay)}})}};var j=function(o,p){b(o,p).off(".yiiActiveForm")};var k=function(o,q,p,s){var r=o.data("yiiActiveForm");if(p){q.status=2}g.each(r.attributes,function(){if(this.value!==f(o,this)){this.status=2;p=true}});if(!p){return}if(r.settings.timer!==undefined){clearTimeout(r.settings.timer)}r.settings.timer=setTimeout(function(){if(r.submitting||o.is(":hidden")){return}g.each(r.attributes,function(){if(this.status===2){this.status=3;o.find(this.container).addClass(r.settings.validatingCssClass)}});c.validate.call(o)},s?s:200)};var a=function(){var o=[];o.add=function(p){this.push(new g.Deferred(p))};return o};var m=function(o,r,u){var t=o.data("yiiActiveForm");if(u){var q=[];g.each(t.attributes,function(){if(!this.cancelled&&i(o,this,r)){q.push(this.input)}});o.trigger(n.afterValidate,[r]);l(o,r);if(q.length){var v=o.find(q.join(",")).first().closest(":visible").offset().top;var p=g(window).scrollTop();if(v<p||v>p+g(window).height){g(window).scrollTop(v)}t.submitting=false}else{t.validated=true;var s=t.submitObject||o.find(":submit:first");if(s.length){s.click()}else{o.submit()}}}else{g.each(t.attributes,function(){if(!this.cancelled&&(this.status===2||this.status===3)){i(o,this,r)}})}};var i=function(q,s,r){var t=q.data("yiiActiveForm"),v=b(q,s),p=false;if(!g.isArray(r[s.id])){r[s.id]=[]}q.trigger(n.afterValidateAttribute,[s,r[s.id]]);s.status=1;if(v.length){p=r[s.id].length>0;var u=q.find(s.container);var o=u.find(s.error);if(p){if(s.encodeError){o.text(r[s.id][0])}else{o.html(r[s.id][0])}u.removeClass(t.settings.validatingCssClass+" "+t.settings.successCssClass).addClass(t.settings.errorCssClass)}else{o.empty();u.removeClass(t.settings.validatingCssClass+" "+t.settings.errorCssClass+" ").addClass(t.settings.successCssClass)}s.value=f(q,s)}return p};var l=function(p,r){var s=p.data("yiiActiveForm"),o=p.find(s.settings.errorSummary),q=o.find("ul").empty();if(o.length&&r){g.each(s.attributes,function(){if(g.isArray(r[this.id])&&r[this.id].length){var t=g("<li/>");if(s.settings.encodeErrorSummary){t.text(r[this.id][0])}else{t.html(r[this.id][0])}q.append(t)}});o.toggle(q.find("li").length>0)}};var f=function(p,r){var s=b(p,r);var q=s.prop("type");if(q==="checkbox"||q==="radio"){var o=s.filter(":checked");if(!o.length){o=p.find('input[type=hidden][name="'+s.prop("name")+'"]')}return o.val()}else{return s.val()}};var b=function(o,p){var q=o.find(p.input);if(q.length&&q[0].tagName.toLowerCase()==="div"){return q.find("input")}else{return q}}})(window.jQuery);